image: archlinux
packages:
  - rustup
tasks:
  - rustup: |
      # We specify --profile minimal because we'd otherwise download docs
      rustup toolchain install 1.36.0 --profile minimal
      rustup default 1.36.0
  - test: |
      cd ruma-serde

      # We don't want the build to stop on individual failure of independent
      # tools, so capture tool exit codes and set the task exit code manually
      set +e

      # Only make sure the code builds with the MSRV. Tests can require later
      # Rust versions, don't compile or run them.
      cargo build --no-default-features --verbose
      build1_exit=$?

      cargo build --all-features --verbose
      build2_exit=$?

      exit $(( $fmt_exit || $build1_exit || $build2_exit ))
